<style>
  #progress_bar {
    margin: 10px 0;
    padding: 3px;
    border: 1px solid #000;
    font-size: 14px;
    clear: both;
    opacity: 0;
    -moz-transition: opacity 1s linear;
    -o-transition: opacity 1s linear;
    -webkit-transition: opacity 1s linear;
  }
  #progress_bar.loading {
    opacity: 1.0;
  }
  #progress_bar .percent {
    background-color: #99ccff;
    height: auto;
    width: 0;
  }
  #drop_zone {
    width: 100%;
    height: 300px;
    border: 1px dashed gray;
  }
</style>


<a href="/download">Download</a>
<div id="drop_zone">Drop files here</div>
<div id="progress_bar"><div class="percent">0%</div></div>

<script>
  var progress = document.querySelector('.percent');

  function updateProgress(evt) {
    // evt is an ProgressEvent.
    if (evt.lengthComputable) {
      var percentLoaded = Math.round((evt.loaded / evt.total) * 100);
      // Increase the progress bar length.
      if (percentLoaded < 100) {
        progress.style.width = percentLoaded + '%';
        progress.textContent = percentLoaded + '%';
      }
    }
  }

  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    // Reset progress indicator on new file selection.
    progress.style.width = '0%';
    progress.textContent = '0%';

    var files = evt.dataTransfer.files;
    var formData = new FormData();
    for (var i = 0, f; f = files[i]; i++) {
      formData.append('file', f);
    }

    // now post a new XHR request
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/upload');
    xhr.onload = function () {
      if (xhr.status === 200) {
        progress.style.width = '100%';
        progress.textContent = '100%';
      }
    };
    document.getElementById('progress_bar').className = 'loading';
    xhr.upload.onprogress = updateProgress;

    xhr.send(formData);
  }

  function handleDragOver(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
    }

  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
</script>
